---
tags:
  - JavaScript
  - Node.JS
---

<img src="https://pbs.twimg.com/media/HAbMrGzWMAAbh5p?format=jpg&name=medium" alt="tasty crousty goumin 67 doro">

# Asynchrone et promesses (06/02/26)

!!! info
    Pour le TP, on a besoin de manipuler des fichiers. Mais avant d'utiliser le module *file system dit "fs"* (qui s'occupe de ce besoin), il faut comprendre un fonctionnement de base en informatique, essentielle aux modules faisant des requ√™tes a des systemes externes comme *fs*, **l'asynchrone**. 

## C'est quoi Asynchrone ?

Asynchrone permet de ne pas bloquer le code m√™me si il n'a pas de r√©sultat mais avec promesse, il laisse le code continuer pour trouver une r√©ponse et la rapporter comme promis.

*Rien de mieux qu'un exemple concret et gourmand en amont et en aval.*

### 1. SANS Asynchrone

1. Tu commandes un Tasty Crousty.
2. Ce neuille de caissier part en cuisine.
3. Il fait cuire le riz lui-m√™me.
4. Il coupe les tenders.
5. Il met tout dans la barquette puis sauce.
6. Et revient pour te donner le Tasty Crousty 67 doro party.
7. **SEULEMENT MAINTENANT**, il prend la commande du gwer suivant.

**R√©sultat :** La file d'attente sort du restaurant. Si la cuisson prend 10 minutes, tout le restaurant est bloqu√© pendant 10 minutes. Bien guez.

---

### 2. AVEC Asynchrone

1. Tu commandes un Tasty Crouspy.
2. La caissi√®re crie en cuisine "Un Crousty piquant sucr√© suppl√©ment poulet !".
3. Elle te donne un bipeur, faisant donc **la promesse** de te servir un d√©licieux Crouspy Tasty.
4. Puis elle passe **directement** au client suivant.
5. Toi, tu vas t'asseoir et tu attends.

## Mais c'est quoi cette promesse ? (Promise)

!!! note
    ‚òùÔ∏èü§ì Node.js fonctionne sur un principe de **thread unique** (monothread)... En gros, il ne peut effectuer qu'une seule t√¢che √† la fois.

    Alors pour √©viter de bloquer le programme pendant de longues op√©rations (comme lire des donn√©es au fin fond du disque dur), il d√©l√®gue ces t√¢ches a l'ordinateur et utilise un m√©canisme de **Promesses**.

Dans notre exemple, **la Promise, c'est le bipeur.**

Ce bo√Ætier est une promesse. Le restaurant te dit : *"Je n'ai pas ton crousty tout de suite, mais je te promets que je te pr√©viendrai d√®s qu'il y a du nouveau."*

Une Promise a toujours **3 √©tats possibles**, et seulement 3 :

1. **En attente (Pending) :** Le bo√Ætier ne fait rien. Le cuisinier travaille. Tu attends.
2. **Succ√®s (Resolved) :** Le bo√Ætier vibre ! La promesse est tenue, tu as ton chicken (la donn√©e est arriv√©e).
3. **√âchec (Rejected) :** Le manager arrive et te dit *"D√©sol√©, la cuisine a pris feu, pas de d√©licieux crousty pour ce soir"*. La promesse est rompue (il y a une erreur).

## Exemples async et await

### Exemple d'un async (exo du TP 2 de JS)

```javascript
files.forEach((fileName) => {
    fs.readFile(fileName, 'utf8').then((content) => {
        ...
    })
});
```

* **`fs.readFile`** : Envoie le job de lire un fichier √† l'ordinateur avec des parametres et quand c'est pret, enrengistre son r√©sultat dans `content`.
* **La Promise** : En lan√ßant fs.readFile, celui-ci promet que d√®s qu'il a un r√©sultat, il le renverra dans `content`

### Exemple concret await (exo du TP 2 de JS)

On peut √©galement demander sp√©cifiquement d'attendre le retour d'une promesse avec `await`

```javascript
const stats = await fs.stat(filename);
```

* **`fs.stat`** : Envoie le job de r√©cup√©rer les stats d'un fichier √† l'ordinateur et quand c'est pret, enrengistre son r√©sultat dans `stats`.
* **La Promise** : On te promet un r√©sultat dans `stats`
* `**await**` : Tant que l'on a pas de r√©sultat, on "fige" √† cette ligne jusqu'√† ce que la promesse est re√ßue.